import numpy as np
from scipy import sparse
from SoftmaxRegression import *
def one_hot_coding(labels):
    N, M = len(labels), len(np.unique(labels))
    return sparse.coo_matrix((np.ones(N), (np.arange(N), labels)), shape = (N,M)).toarray()
X = [["....................",   "........###.........",   ".....####.####......",   "....##.......##.....",   "...##.........##....",   "...#...........#....",   "...............##...",   "................#...",   "...............##...",   "...............#....",   "..............##....",   "............##......",   "...........##.......",   ".........##.........",   "..########..........",   "..#..#####.......##.",   "..####....########..",   "..##................",   "....................",   "...................."],
["....................",   "....................",   ".........#..........",   "........##..........",   ".......#............",   "......##............",   "......#.............",   ".....##.............",   "....##..............",   "....#...............",   "...##.....#.........",   "..##......#.........",   "..#.......#.........",   ".##############.....",   "..........#.........",   ".........##.........",   ".........#..........",   ".........#..........",   "....................",  "...................."],
["....................",   "....................",   "..............##....",   ".....#########......",   ".....#..............",   ".....#..............",   "....#...............",   "....#...............",   "....#...............",   "....########........",   "............##......",   "..............#.....",   "..............##....",   "...............#....",   "..............#.....",   "....#.......##......",   "....#####.##........",   "....................",   "....................",   "...................."],
["....................",   "....................",   "....................",   "...###############..",   "..##............##..",   "...............##...",   "...............#....",   "..............#.....",   ".............##.....",   ".............#......",   "............##......",   "............#.......",   "........#########...",   "........#..#........",   "..........##........",   "..........#.........",   ".........#..........",   "........##..........",   "........#...........",   ".......##..........."],
["....................",   "....................",   ".......####.........",   ".....##...###.......",   "....#.......#.......",   "....#.......##......",   "....#........#......",   "....#........#......",   "....#......##.......",   ".....########.......",   "............#.......",   "...........##.......",   "...........#........",   "..........##........",   "..........#.........",   ".........##.........",   ".........#..........",   "........##..........",   ".......##...........",   "...................."],
["....................",   "....................",   "..........#########.",   ".....#####..........",   "....##..............",   "...##...............",   "...#................",   "..##................",   "..#.................",   ".########...........",   ".#.......####.......",   ".............##.....",   "..............##....",   "...............#....",   "...............#....",   "...............#....",   "...#..........##....",   "...###.......##.....",   ".....#########......",   "...................."],
["....................",   "....................",   "........###.........",   "......###.####......",   ".....##......#......",   ".....#.......#......",   "....##.......#......",   "....#........#......",   "....##......#.......",   ".....#......#.......",   "......######........",   "..........##........",   ".......###..##......",   "......#.......#.....",   ".....#.........#....",   ".....#.........#....",   "....#..........#....",   "....##........##....",   "......###....#......",   "..........###......."],
["....................",   "......#####.........",   ".....#....##........",   "...........##.......",   "............#.......",   "............#.......",   "............#.......",   "...........##.......",   ".........##.........",   "........##..........",   "..........##........",   "...........#........",   "...........##.......",   "............#.......",   "..#.........#.......",   "..#........##.......",   "..##.......#........",   "...##....##.........",   "....#####...........",   "...................."],
["....................",   "....................",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   "........#...........",   "........#...........",   "........#...........",   ".......#............",   ".......#............",   ".......#............",   ".......#............",   ".......#............",   "......#.............",   "......#.............",   "......#.............",   "...................."],
["....................",   ".........#..........",   ".........#..........",   "........#...........",   ".......##...........",   ".......#............",   "......##............",   "......#.............",   ".....##.............",   ".....#..............",   "....##......#.......",   "...##.......#.......",   "...#........#.......",   "...#........#.......",   "..###############...",   "............#.......",   "............#.......",   "............#.......",   "............#.......",   "...................."],
["....................",   "....................",   ".......############.",   ".......#............",   "......##............",   "......#.............",   "......#.............",   "......#.............",   "......######........",   "............##......",   ".............##.....",   "..............#.....",   "..............##....",   "...............#....",   "..............#.....",   "...##.........#.....",   ".....###..####......",   ".......####.........",   "....................",   "...................."],
["....................",   "....................",   "......######........",   ".....#.....####.....",   ".....#........##....",   ".....#.........#....",   "....##..........#...",   "....#...........#...",   "....#...........#...",   "....#...........#...",   "....#...........#...",   "....#...........#...",   "....#...........#...",   "....#...........#...",   "....#..........##...",   "....##.........#....",   ".....##.......##....",   "......###....#......",   "........#####.......",   "...................."],
["....................",   "....................",   "........#...........",   ".......#............",   "......##............",   "......#.............",   ".....#..............",   "....##..............",   "....#........#......",   "...##........#......",   "...#.........#......",   "...#.........#......",   "..##.........#......",   ".##..........#......",   "..#########.##..#...",   "..........#######...",   "............#.......",   "............#.......",   "............##......",   ".............#......"],
["....................",   "....................",   ".....#######........",   "....#......##.......",   "....#.......#.......",   "....#.......#.......",   "....#......##.......",   "....#.....###.......",   "....######..#.......",   "............#.......",   "............#.......",   "...........#........",   "...........#........",   "...........#........",   "...........#........",   "...........#........",   "...........#........",   "..........##........",   "....................",   "...................."],
["....................",   "....................",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   "........#...........",   "........#...........",   "........#...........",   "........#...........",   ".......##...........",   ".......#............",   ".......#............",   ".......#............",   ".......#............",   ".......#............",   "......##............",   "...................."],
["....................",   "....................",   ".....######.........",   ".....#....###.......",   "............#.......",   "............##......",   "............##......",   "............#.......",   "...........##.......",   "..........#.........",   ".........#####......",   ".............#......",   ".............#......",   ".............#......",   ".............#......",   ".............#......",   "...##.......#.......",   "....#######.........",   "....................",   "...................."],
["....................",   "....................",   ".......####.........",   ".....##....##.......",   "....#........##.....",   "..............##....",   "...............#....",   "...............#....",   "..............#.....",   ".............##.....",   ".............#......",   "............#.......",   "............#.......",   "...........#........",   ".........##.........",   ".........#..........",   ".......##...........",   ".....##.............",   ".....############...",   "...................."],
["....................",   "....................",   "..........####......",   ".......####..#......",   "....###.....#.......",   "...........##.......",   "..........##........",   "..........#.........",   ".........#..........",   "........#######.....",   "..............##....",   "...............#....",   "...............#....",   "..............##....",   ".............##.....",   "...........###......",   "......#####.........",   "....##..............",   "....................",   "...................."],
["....................",   "....................",   "..........##........",   "........###.........",   "........#...........",   ".......#............",   "......##............",   "......#.............",   "......#.............",   "......#.............",   "......#...###.......",   "......#.###.####....",   "......###......#....",   ".......#.......#....",   ".......##......#....",   "........########....",   "....................",   "....................",   "....................",   "...................."],
["....................",   "....................",   "...#############....",   "...#................",   "...#................",   "..##................",   "..#.................",   "..#.................",   ".##.................",   ".###############....",   "...............##...",   "................##..",   ".................#..",   ".................#..",   "................#...",   ".....#.........##...",   ".....###......##....",   ".......########.....",   "....................",   "...................."],
["....................",   "....................",   ".......#............",   ".......#............",   "........#...........",   "........#...........",   "........#...........",   "........#...........",   "........#...........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........##.........",   "..........#.........",   "..........#.........",   "..........#.........",   "...................."],
["....................",   "....................",   ".........#..........",   ".......###..........",   "......##.#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   ".........#..........",   "......#######.......",   "....................",   "...................."],
["....................",   "....................",   ".......##...........",   "......##.###........",   "...........##.......",   "............#.......",   "............#.......",   "............#.......",   "..........##........",   ".........###........",   "............##......",   ".............#......",   ".............##.....",   "..............#.....",   ".............##.....",   ".............#......",   "....#.......#.......",   "....########........",   "....................",   "...................."],
["....................",   "....................",   ".......####.........",   ".....###..###.......",   ".....#......##......",   "....##.......##.....",   "....#.........##....",   "...##..........##...",   "...#............#...",   "...#............#...",   "..#..............#..",   "..#..............#..",   "..#..............#..",   "..##.............#..",   "...#............#...",   "...##...........#...",   ".....#.........##...",   "......##.....##.....",   "........#####.......",   "...................."],
["....................",   "....................",   "....############....",   "..............##....",   ".............##.....",   "............##......",   "............#.......",   "............#.......",   "...........##.......",   "...........#........",   "...........#........",   "..........#.........",   "..........#.........",   "..........#.........",   ".........##.........",   ".........#..........",   "........##..........",   "........#...........",   "........#...........",   "...................."],
["....................",   "........###.........",   "......##...##.......",   ".....#.......#......",   "....#.........#.....",   "....#.........#.....",   "....#.........#.....",   ".....#.......#......",   "......#.....#.......",   ".......#####........",   ".....##.....##......",   "....#.........#.....",   "...#...........#....",   "...#...........#....",   "..#.............#...",   "..#.............#...",   "..#.............#...",   "...#...........#....",   "....##.......##.....",   "......#######......."],
["....................",   "...##############...",   "..#..............#..",   ".................#..",   "................#...",   "...............#....",   "..............#.....",   ".............#......",   "............#.......",   "............#.......",   ".......########.....",   "...........#........",   "..........#.........",   "..........#.........",   ".........#..........",   ".........#..........",   "........#...........",   "........#...........",   "........#...........",   "........#..........."],
["................#...",   ".....###########....",   "....#...............",   "....#...............",   "...#................",   "...#................",   "..#.................",   "..#.................",   "..######............",   "........#####.......",   ".............##.....",   "...............#....",   "................#...",   "................#...",   "................#...",   "................#...",   "...............#....",   "...............#....",   "....#.........#.....",   ".....#########......"],
["....................",   "........###.........",   "......##...##.......",   ".....#.......#......",   "....#.........#.....",   "....#.........#.....",   "...#...........#....",   "...#...........#....",   "...#...........#....",   "..#.............#...",   "..#.............#...",   "..#.............#...",   "...#...........#....",   "...#...........#....",   "...#...........#....",   "....#.........#.....",   "....#.........#.....",   ".....#.......#......",   "......##...##.......",   "........###........."],
["....................",   ".........#..........",   ".........#..........",   "........#...........",   ".......#............",   ".......#............",   "......#.............",   ".....#..............",   ".....#......#.......",   "....#.......#.......",   "...#........#.......",   "...#........#.......",   "..##############....",   "............#.......",   "............#.......",   "............#.......",   "............#.......",   "............#.......",   "............#.......",   "...................."]]
y = np.array([2, 4,5, 7, 9, 5, 8, 3, 1, 4, 5, 0, 4, 9, 1, 3, 2, 3, 6, 5, 1, 1, 3,  0, 7, 8, 7, 5, 0, 4])
X = np.array([np.array(list(''.join(img))) for img in X])
X[X == '.'] = 0
X[X == '#'] = 1
X = X.astype('float64')
data = X
from sklearn.decomposition import PCA
pca = PCA(n_components = 4)
X = pca.fit_transform(X, y)
W = pca.components_
W = W.round(1) * 10

X = data @ W.T
model = SoftmaxRegression(max_iter = 500, learning_rate = 3)
model.fit(X, y)


print(np.mean(model.predict(X) == y))
print(list(model.coef_))
print(list(model.intercept_))
